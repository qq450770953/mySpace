<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•CSRF.jså’ŒLogin.jså…¼å®¹æ€§</title>
    <meta name="csrf-token" content="test-csrf-token">
</head>
<body>
    <h1>æµ‹è¯•CSRF.jså’ŒLogin.jså…¼å®¹æ€§</h1>
    <div id="result"></div>

    <script>
        // å…¨å±€å‡½æ•°ï¼Œç”¨äºæ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function logResult(message, isError = false) {
            const resultDiv = document.getElementById('result');
            const p = document.createElement('p');
            p.textContent = message;
            p.style.color = isError ? 'red' : 'green';
            resultDiv.appendChild(p);
            console.log(message);
        }
        
        // æµ‹è¯•å˜é‡æ˜¯å¦è¢«æ­£ç¡®éš”ç¦»
        function testVariableIsolation() {
            try {
                // å°è¯•è®¿é—®å…¨å±€å˜é‡csrfTokenï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¯´æ˜è¢«æ­£ç¡®éš”ç¦»
                if (typeof csrfToken === 'undefined') {
                    logResult('âœ… å˜é‡éš”ç¦»æµ‹è¯•é€šè¿‡: csrfTokenå˜é‡ä¸åœ¨å…¨å±€ä½œç”¨åŸŸ');
                } else {
                    logResult('âŒ å˜é‡éš”ç¦»æµ‹è¯•å¤±è´¥: csrfTokenå˜é‡ä»å­˜åœ¨äºå…¨å±€ä½œç”¨åŸŸ', true);
                }
                
                // æµ‹è¯•å¯¼å‡ºçš„å‡½æ•°æ˜¯å¦å¯ç”¨
                if (typeof window.getCsrfToken === 'function') {
                    logResult('âœ… å‡½æ•°å¯¼å‡ºæµ‹è¯•é€šè¿‡: getCsrfTokenå‡½æ•°å¯ç”¨');
                    
                    // æµ‹è¯•å‡½æ•°æ˜¯å¦æ­£å¸¸å·¥ä½œ
                    const token = window.getCsrfToken();
                    logResult(`getCsrfTokenå‡½æ•°è¿”å›å€¼: ${token || 'æ— '}`);
                } else {
                    logResult('âŒ å‡½æ•°å¯¼å‡ºæµ‹è¯•å¤±è´¥: getCsrfTokenå‡½æ•°ä¸å¯ç”¨', true);
                }
            } catch (error) {
                logResult(`âŒ æµ‹è¯•è¿‡ç¨‹ä¸­å‡ºé”™: ${error.message}`, true);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œæµ‹è¯•
        window.addEventListener('load', function() {
            logResult('ğŸ” å¼€å§‹æµ‹è¯•CSRF.jså’ŒLogin.jså…¼å®¹æ€§...');
            
            // å»¶è¿Ÿæ‰§è¡Œæµ‹è¯•ä»¥ç¡®ä¿æ‰€æœ‰è„šæœ¬å·²åŠ è½½
            setTimeout(testVariableIsolation, 500);
        });
    </script>

    <!-- é¦–å…ˆåŠ è½½CSRF.js -->
    <script src="/static/js/csrf.js"></script>
    <!-- ç„¶ååŠ è½½login.js -->
    <script src="/static/js/login.js"></script>
</body>
</html> 